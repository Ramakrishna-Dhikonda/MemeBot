#cloud-config
package_update: true
packages:
  - git
  - curl

write_files:
  - path: /tmp/docker-compose.yml
    permissions: "0644"
    content: |
${app_compose}

runcmd:
  - [bash, -lc, "curl -fsSL https://get.docker.com | sh"]
  - [bash, -lc, "mkdir -p /opt/memebot"]
  - [bash, -lc, "git clone --branch ${repo_branch} ${repo_url} /opt/memebot"]
  - [bash, -lc, "mv /tmp/docker-compose.yml /opt/memebot/infra/docker-compose.yml"]
  - [bash, -lc, "cd /opt/memebot/infra && docker compose up -d --build"]
